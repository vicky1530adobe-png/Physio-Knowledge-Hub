<!DOCTYPE html>
<html>
<head>
<title>Admin Panel</title>

<style>
body{font-family:Arial;background:#f4f7fb;text-align:center;}
header{
  background:#1a237e;
  color:white;
  padding:15px;
}
button{
  padding:8px 15px;
  margin:5px;
  background:#1a237e;
  color:white;
  border:none;
  border-radius:5px;
}
input{
  padding:8px;
  width:250px;
}
.card{
  background:white;
  margin:10px auto;
  width:400px;
  padding:10px;
  border-radius:8px;
}
</style>

</head>
<body>

<header>
<h2>Admin Panel</h2>
<button onclick="logout()">Logout</button>
</header>

<h3>Add Book</h3>
<input type="text" id="title" placeholder="Title">
<input type="text" id="subject" placeholder="Subject">
<input type="text" id="pdfURL" placeholder="Google Drive Link">
<button onclick="addBook()">Add</button>

<h3>Books List</h3>
<div id="books"></div>

<h3>Approve Students</h3>
<div id="students"></div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAyQWphWzWz10vy-gQz4fq517ChU2MJtUc",
  authDomain: "physio-knowledge-hub.firebaseapp.com",
  projectId: "physio-knowledge-hub",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth,async(user)=>{
 if(!user){
   window.location.href="index.html";
 }else{
   const snap=await getDoc(doc(db,"users",user.uid));
   if(snap.data().role!=="admin"){
     window.location.href="dashboard.html";
   }
 }
});

window.logout=function(){
 signOut(auth).then(()=>{
   window.location.href="index.html";
 });
}

window.addBook=async function(){
 const title=document.getElementById("title").value;
 const subject=document.getElementById("subject").value;
 const pdfURL=document.getElementById("pdfURL").value;

 await addDoc(collection(db,"books"),{title,subject,pdfURL});
 alert("Book Added");
 loadBooks();
}

async function loadBooks(){
 const qs=await getDocs(collection(db,"books"));
 const container=document.getElementById("books");
 container.innerHTML="";
 qs.forEach(d=>{
   const data=d.data();
   container.innerHTML+=`
   <div class="card">
     ${data.title}
     <button onclick="deleteBook('${d.id}')">Delete</button>
   </div>`;
 });
}

window.deleteBook=async function(id){
 await deleteDoc(doc(db,"books",id));
 loadBooks();
}

async function loadStudents(){
 const qs=await getDocs(collection(db,"users"));
 const container=document.getElementById("students");
 container.innerHTML="";
 qs.forEach(d=>{
   const data=d.data();
   if(data.role==="student" && data.approved===false){
     container.innerHTML+=`
     <div class="card">
       ${d.id}
       <button onclick="approve('${d.id}')">Approve</button>
     </div>`;
   }
 });
}

window.approve=async function(id){
 await updateDoc(doc(db,"users",id),{approved:true});
 loadStudents();
}

loadBooks();
loadStudents();

</script>

</body>
</html>