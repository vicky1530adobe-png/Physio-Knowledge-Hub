<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAyQWphWzWz10vy-gQz4fq517ChU2MJtUc",
  authDomain: "physio-knowledge-hub.firebaseapp.com",
  projectId: "physio-knowledge-hub",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let allBooks = [];

onAuthStateChanged(auth,(user)=>{
 if(!user){
   window.location.href="index.html";
 }
});

window.logout=function(){
 signOut(auth).then(()=>{
   window.location.href="index.html";
 });
}

async function loadBooks(){
 const querySnapshot = await getDocs(collection(db,"books"));
 allBooks = [];
 querySnapshot.forEach(doc=>{
   allBooks.push(doc.data());
 });
 displayBooks(allBooks);
}

window.searchBooks = function(){

 const searchValue = document.getElementById("search").value.toLowerCase();
 const subjectValue = document.getElementById("subjectFilter").value;

 const filtered = allBooks.filter(book => {

   const matchText =
     book.title.toLowerCase().includes(searchValue) ||
     book.subject.toLowerCase().includes(searchValue);

   const matchSubject =
     subjectValue === "" || book.subject === subjectValue;

   return matchText && matchSubject;
 });

 displayBooks(filtered);
}

function displayBooks(books){
 const container=document.getElementById("books");
 container.innerHTML="";

 if(books.length === 0){
   container.innerHTML="<p>No books found</p>";
   return;
 }

 books.forEach(book=>{
   container.innerHTML+=`
   <div class="card">
     <b>${book.title}</b><br>
     ${book.subject}<br>
     <a href="${book.pdfURL}" target="_blank">Open PDF</a>
   </div>`;
 });
}

loadBooks();

</script>
